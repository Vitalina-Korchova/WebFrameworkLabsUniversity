(()=>{"use strict";var e={419:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Library=void 0,t.Library=class{constructor(){this.items=[]}addItem(e){this.items.push(e)}getAllItems(){return this.items}findItem(e){return this.items.find(e)}removeItem(e){this.items=this.items.filter((t=>!e(t)))}clear(){this.items.length=0}}},369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0,t.Modal=class{static showBorrowModal(e){e.addEventListener("click",(()=>{const e=document.getElementById("modalBorrow");if(e){e.style.display="block";const t=document.getElementById("btn_close_modal");t&&this.closeBorrowModal(t)}}))}static closeBorrowModal(e){e.addEventListener("click",(()=>{document.getElementById("modalBorrow").style.display="none"}))}static hideBorrowModal(){document.getElementById("modalBorrow").style.display="none"}static showErrorModal(){const e=document.getElementById("modalBorrowFail");e.style.display="block",document.getElementById("btn_close_modal_fail").addEventListener("click",(()=>{e.style.display="none"}))}static showSuccessModal(){const e=document.getElementById("modalBorrowSuccess");e.style.display="block",document.getElementById("btn_close_modal_success").addEventListener("click",(()=>{e.style.display="none"}))}}},524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=t.Book=void 0,t.Book=class{constructor(e,t,o){this.nameBook=e,this.authorBook=t,this.releaseYearBook=o}printInfo(){return`${this.nameBook} by ${this.authorBook} (${this.releaseYearBook})`}},t.User=class{constructor(e,t,o){this.borrowedBooksCount=0,this.idUser=e,this.nameUser=t,this.emailUser=o}printInfo(){return`ID: ${this.idUser},  ${this.nameUser} ${this.emailUser}  Позичено книг - ${this.borrowedBooksCount}`}}},154:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryService=void 0;const s=o(524),r=o(419),a=o(421),n=o(369);t.LibraryService=class{constructor(){this.booksLibrary=new r.Library,this.userLibrary=new r.Library,this.borrowStatus={},this.loadData()}addBook(e){this.booksLibrary.addItem(e),this.saveData()}addUser(e){this.userLibrary.addItem(e),this.saveData()}getAllBooks(){return this.booksLibrary.getAllItems()}getAllUsers(){return this.userLibrary.getAllItems()}findBook(e){return this.booksLibrary.findItem(e)}findUser(e){return this.userLibrary.findItem(e)}borrowBook(e,t){const o=this.findUser((e=>e.idUser===t)),s=this.findBook((t=>t.nameBook===e));return console.log(`Found Book: ${s?s.nameBook:"Not Found"}`),console.log(`Found User: ${o?o.idUser:"Not Found"}`),o&&o.borrowedBooksCount>=3?(n.Modal.showErrorModal(),n.Modal.hideBorrowModal(),!1):this.borrowStatus[e]?(console.log("The book is already borrowed."),!1):!(!s||!o||(o.borrowedBooksCount++,this.borrowStatus[e]=t,this.saveData(),n.Modal.showSuccessModal(),0))}returnBook(e){const t=this.borrowStatus[e];if(t){const o=this.findUser((e=>e.idUser===t));return o&&o.borrowedBooksCount--,delete this.borrowStatus[e],this.saveData(),!0}return!1}getBorrowedBooks(){return Object.entries(this.borrowStatus).map((([e,t])=>({bookName:e,userId:t})))}saveData(){a.Storage.saveData("books",this.booksLibrary.getAllItems()),a.Storage.saveData("users",this.userLibrary.getAllItems()),a.Storage.saveData("borrowStatus",this.borrowStatus)}loadData(){const e=a.Storage.loadData("books")||[],t=a.Storage.loadData("users")||[];this.borrowStatus=a.Storage.loadData("borrowStatus")||{},this.booksLibrary.clear(),this.userLibrary.clear(),e.forEach((e=>{const t=new s.Book(e.nameBook,e.authorBook,e.releaseYearBook);this.booksLibrary.addItem(t)})),t.forEach((e=>{const t=new s.User(e.idUser,e.nameUser,e.emailUser);t.borrowedBooksCount=0,this.userLibrary.addItem(t)})),Object.values(this.borrowStatus).forEach((e=>{const t=this.findUser((t=>t.idUser===e));t&&t.borrowedBooksCount++}))}clearBooks(){this.booksLibrary.clear(),this.borrowStatus={},this.saveData(),a.Storage.clearData("book_items")}clearUsers(){this.userLibrary.clear(),this.borrowStatus={},this.saveData(),a.Storage.clearData("user_items")}}},421:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0,t.Storage=class{static saveData(e,t){localStorage.setItem(e,JSON.stringify(t))}static loadData(e){return JSON.parse(localStorage.getItem(e)||"[]")}static clearData(e){localStorage.removeItem(e)}static saveElementState(e,t){localStorage.setItem(e,t)}static loadElementState(e){return localStorage.getItem(e)||""}}},529:(e,t)=>{function o(e,t){const o=e.value.trim(),s=(new Date).getFullYear(),r=parseInt(o);let a=!0;return""===o?(t.textContent="Введіть рік видання!",e.setCustomValidity("invalid"),a=!1):!/^\d{4}$/.test(o)||isNaN(r)||r<1||r>s?(t.textContent=`Введіть коректний рік видання (від 1 до ${s})`,e.setCustomValidity("invalid"),a=!1):(e.classList.add("was-validated"),t.textContent="",e.setCustomValidity("")),a}function s(e,t){const o=e.value.trim();let s=!0;return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(o)?(e.classList.add("was-validated"),t.textContent="",e.setCustomValidity("")):(t.textContent="Введіть правильний email!",e.setCustomValidity("invalid"),s=!1),s}Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationBook=function(){const e=document.querySelectorAll(".needs-validation-book");let t=!0;return e.forEach((function(e){if(e instanceof HTMLFormElement){e.checkValidity()||(t=!1);const s=e.querySelector(".input_release_year"),r=e.querySelector(".input_release_year + .invalid-feedback");s&&r&&(s.addEventListener("input",(function(){o(s,r)})),o(s,r)||(t=!1)),e.classList.add("was-validated"),t&&(e.reset(),e.classList.remove("was-validated"))}})),t},t.ValidationUser=function(){const e=document.querySelectorAll(".needs-validation-user");let t=!0;return e.forEach((function(e){if(e instanceof HTMLFormElement){e.checkValidity()||(t=!1);const o=e.querySelector(".input_email"),r=e.querySelector(".input_email + .invalid-feedback");o&&r&&(o.addEventListener("input",(function(){s(o,r)||(t=!1)})),s(o,r)||(t=!1)),e.classList.add("was-validated"),t&&(e.reset(),e.classList.remove("was-validated"))}})),t}}},t={};function o(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,o),a.exports}(()=>{const e=o(524),t=o(154),s=o(529),r=o(369);class a{constructor(){this.libraryService=new t.LibraryService,this.initializeApp()}initializeApp(){this.loadDataFromLocalStorage(),this.renderBooks(),this.renderUsers(),this.setupEventListeners()}loadDataFromLocalStorage(){console.log(this.libraryService.getAllBooks()),console.log(this.libraryService.getAllUsers()),this.renderBooks(),this.renderUsers()}renderBooks(){const e=document.querySelector(".book_items");e&&(e.innerHTML="",this.libraryService.getAllBooks().forEach((t=>{this.renderBookItem(t,e)})))}renderUsers(){const e=document.querySelector(".user_items");e&&(e.innerHTML="",this.libraryService.getAllUsers().forEach((t=>{this.renderUserItem(t,e)})))}renderBookItem(e,t){const o=document.createElement("div");o.classList.add("book-item"),o.dataset.bookName=e.nameBook;const s=document.createElement("div");s.classList.add("d-flex","justify-content-between");const a=document.createElement("span");a.textContent=e.printInfo(),a.classList.add("fs-5");const n=document.createElement("button");n.textContent="Позичити",n.type="button",n.classList.add("btnBorrowOff","btn","btn-primary","btn-sm");const i=this.libraryService.getBorrowedBooks().find((t=>t.bookName===e.nameBook));if(i){n.style.display="none";const t=this.createReturnButton(e.nameBook,i.userId);s.appendChild(t),s.classList.add("flex-row-reverse")}else r.Modal.showBorrowModal(n);s.appendChild(a),s.appendChild(n);const d=document.createElement("hr");o.appendChild(s),o.appendChild(d),t.appendChild(o)}renderUserItem(e,t){const o=document.createElement("div");o.classList.add("user-item"),o.dataset.userId=e.idUser.toString();const s=document.createElement("div");s.classList.add("d-flex","justify-content-between");const r=document.createElement("span");r.textContent=e.printInfo(),r.classList.add("fs-5");const a=document.createElement("hr");s.appendChild(r),o.appendChild(s),o.appendChild(a),t.appendChild(o)}setupEventListeners(){this.setupBookListeners(),this.setupUserListeners(),this.setupModalListeners()}setupBookListeners(){const e=document.querySelector(".input_add_book"),t=document.querySelector(".btn_clear_books");e&&e.addEventListener("click",this.handleAddBook.bind(this)),t&&t.addEventListener("click",this.handleClearBooks.bind(this))}setupUserListeners(){const e=document.querySelector(".input_add_user"),t=document.querySelector(".btn_clear_users");e&&e.addEventListener("click",this.handleAddUser.bind(this)),t&&t.addEventListener("click",this.handleClearUsers.bind(this))}setupModalListeners(){document.addEventListener("click",(e=>{const t=e.target;t.classList.contains("btnBorrowOff")?this.handleBorrowButtonClick(t):t.classList.contains("btnReturn")&&this.handleReturnButtonClick(t)}));const e=document.getElementById("btn_save");e&&e.addEventListener("click",this.handleSaveBorrow.bind(this))}handleAddBook(t){var o,r,a;t.preventDefault();const n=null===(o=document.querySelector(".input_name_book"))||void 0===o?void 0:o.value,i=null===(r=document.querySelector(".input_author_book"))||void 0===r?void 0:r.value,d=null===(a=document.querySelector(".input_release_year"))||void 0===a?void 0:a.value;if((0,s.ValidationBook)()){const t=new e.Book(n,i,parseInt(d));this.libraryService.addBook(t),this.renderBooks()}}handleClearBooks(){this.libraryService.clearBooks(),this.renderBooks()}handleAddUser(t){var o,r;t.preventDefault();const a=null===(o=document.querySelector(".input_username"))||void 0===o?void 0:o.value,n=null===(r=document.querySelector(".input_email"))||void 0===r?void 0:r.value;if((0,s.ValidationUser)()){const t=this.getNextUserId(),o=new e.User(t,a,n);this.libraryService.addUser(o),this.renderUsers()}}handleClearUsers(){this.libraryService.clearUsers(),this.renderUsers(),localStorage.removeItem("lastUserId")}handleBorrowButtonClick(e){const t=e.closest(".book-item");if(t){const o=t.dataset.bookName;o&&(e.dataset.bookName=o)}}handleReturnButtonClick(e){const t=e.dataset.bookName,o=e.dataset.userId;t&&o&&(this.libraryService.returnBook(t),this.renderBooks(),this.updateUserBorrowedCount(parseInt(o)))}handleSaveBorrow(){const e=document.getElementById("input_borrow"),t=document.querySelector(".btnBorrowOff[data-book-name]");if(t&&e){const o=e.value.trim(),s=t.dataset.bookName;o&&s&&this.libraryService.borrowBook(s,parseInt(o))&&(this.renderBooks(),this.updateUserBorrowedCount(parseInt(o)),r.Modal.hideBorrowModal())}}createReturnButton(e,t){const o=document.createElement("button");return o.textContent="Повернути",o.classList.add("btn","btn-warning","btnReturn","btn-sm"),o.dataset.bookName=e,o.dataset.userId=t.toString(),o}updateUserBorrowedCount(e){const t=this.libraryService.findUser((t=>t.idUser===e));if(t){const o=document.querySelector(`.user-item[data-user-id="${e}"]`);if(o){const e=o.querySelector("span");e&&(e.textContent=t.printInfo())}}}getNextUserId(){const e=parseInt(localStorage.getItem("lastUserId")||"0")+1;return localStorage.setItem("lastUserId",e.toString()),e}}document.addEventListener("DOMContentLoaded",(()=>{console.log("DOM fully loaded and parsed"),new a}))})()})();