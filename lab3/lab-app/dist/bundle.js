(()=>{"use strict";var e={419:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Library=void 0,t.Library=class{constructor(){this.items=[]}addItem(e){this.items.push(e)}getAllItems(){return this.items}findItem(e){return this.items.find(e)}removeItem(e){this.items=this.items.filter((t=>!e(t)))}clear(){this.items.length=0}}},369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Modal=void 0,t.Modal=class{static showBorrowModal(e){e.addEventListener("click",(()=>{const e=document.getElementById("modalBorrow");if(e){e.style.display="block";const t=document.getElementById("btn_close_modal");t&&this.closeBorrowModal(t)}}))}static closeBorrowModal(e){e.addEventListener("click",(()=>{document.getElementById("modalBorrow").style.display="none"}))}static hideBorrowModal(){document.getElementById("modalBorrow").style.display="none"}static showErrorModal(){const e=document.getElementById("modalBorrowFail");e.style.display="block",document.getElementById("btn_close_modal_fail").addEventListener("click",(()=>{e.style.display="none"}))}static showSuccessModal(){const e=document.getElementById("modalBorrowSuccess");e.style.display="block",document.getElementById("btn_close_modal_success").addEventListener("click",(()=>{e.style.display="none"}))}}},524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=t.Book=void 0,t.Book=class{constructor(e,t,o){this.nameBook=e,this.authorBook=t,this.releaseYearBook=o}printInfo(){return`${this.nameBook} by ${this.authorBook} (${this.releaseYearBook})`}},t.User=class{constructor(e,t,o){this.borrowedBooksCount=0,this.idUser=e,this.nameUser=t,this.emailUser=o}printInfo(){return`ID: ${this.idUser},  ${this.nameUser} ${this.emailUser}    Позичено книг - ${this.borrowedBooksCount}`}}},154:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryService=void 0;const r=o(524),s=o(419),a=o(421),i=o(369);t.LibraryService=class{constructor(){this.booksLibrary=new s.Library,this.userLibrary=new s.Library,this.borrowStatus={},this.loadData()}addBook(e){this.booksLibrary.addItem(e),this.saveData()}addUser(e){this.userLibrary.addItem(e),this.saveData()}getAllBooks(){return this.booksLibrary.getAllItems()}getAllUsers(){return this.userLibrary.getAllItems()}findBook(e){return this.booksLibrary.findItem(e)}findUser(e){return this.userLibrary.findItem(e)}borrowBook(e,t){const o=this.findUser((e=>e.idUser===t)),r=this.findBook((t=>t.nameBook===e));return console.log(`Found Book: ${r?r.nameBook:"Not Found"}`),console.log(`Found User: ${o?o.idUser:"Not Found"}`),o&&o.borrowedBooksCount>=3?(i.Modal.showErrorModal(),i.Modal.hideBorrowModal(),!1):this.borrowStatus[e]?(console.log("The book is already borrowed."),!1):!(!r||!o||(o.borrowedBooksCount++,this.borrowStatus[e]=t,this.saveData(),i.Modal.showSuccessModal(),0))}returnBook(e){const t=this.borrowStatus[e];if(t){const o=this.findUser((e=>e.idUser===t));return o&&o.borrowedBooksCount--,delete this.borrowStatus[e],this.saveData(),!0}return!1}getBorrowedBooks(){return Object.entries(this.borrowStatus).map((([e,t])=>({bookName:e,userId:t})))}saveData(){a.Storage.saveData("books",this.booksLibrary.getAllItems()),a.Storage.saveData("users",this.userLibrary.getAllItems()),a.Storage.saveData("borrowStatus",this.borrowStatus)}loadData(){const e=a.Storage.loadData("books")||[],t=a.Storage.loadData("users")||[];this.borrowStatus=a.Storage.loadData("borrowStatus")||{},this.booksLibrary.clear(),this.userLibrary.clear(),e.forEach((e=>{const t=new r.Book(e.nameBook,e.authorBook,e.releaseYearBook);this.booksLibrary.addItem(t)})),t.forEach((e=>{const t=new r.User(e.idUser,e.nameUser,e.emailUser);t.borrowedBooksCount=0,this.userLibrary.addItem(t)})),Object.values(this.borrowStatus).forEach((e=>{const t=this.findUser((t=>t.idUser===e));t&&t.borrowedBooksCount++}))}clearBooks(){this.booksLibrary.clear(),this.borrowStatus={},this.saveData(),a.Storage.clearData("book_items")}clearUsers(){this.userLibrary.clear(),this.borrowStatus={},this.saveData(),a.Storage.clearData("user_items")}}},421:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Storage=void 0,t.Storage=class{static saveData(e,t){localStorage.setItem(e,JSON.stringify(t))}static loadData(e){return JSON.parse(localStorage.getItem(e)||"[]")}static clearData(e){localStorage.removeItem(e)}static saveElementState(e,t){localStorage.setItem(e,t)}static loadElementState(e){return localStorage.getItem(e)||""}}},529:(e,t)=>{function o(e,t){const o=e.value.trim(),r=(new Date).getFullYear(),s=parseInt(o);let a=!0;return""===o?(t.textContent="Введіть рік видання!",e.setCustomValidity("invalid"),a=!1):!/^\d{4}$/.test(o)||isNaN(s)||s<1||s>r?(t.textContent=`Введіть коректний рік видання (від 1 до ${r})`,e.setCustomValidity("invalid"),a=!1):(e.classList.add("was-validated"),t.textContent="",e.setCustomValidity("")),a}Object.defineProperty(t,"__esModule",{value:!0}),t.ValidationBook=function(){const e=document.querySelectorAll(".needs-validation-book");let t=!0;return e.forEach((function(e){if(e instanceof HTMLFormElement){e.checkValidity()||(t=!1);const r=e.querySelector(".input_release_year"),s=e.querySelector(".input_release_year + .invalid-feedback");r&&s&&(r.addEventListener("input",(function(){o(r,s)})),o(r,s)||(t=!1)),e.classList.add("was-validated"),t&&(e.reset(),e.classList.remove("was-validated"))}})),t},t.ValidationUser=function(){const e=document.querySelectorAll(".needs-validation-user");let t=!0;return e.forEach((function(e){if(e instanceof HTMLFormElement){e.checkValidity()||(t=!1);const o=e.querySelector(".input_email"),r=e.querySelector(".input_email + .invalid-feedback"),s=/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;o&&r&&o.addEventListener("input",(function(){s.test(o.value.trim())?(o.classList.add("was-validated"),r.textContent="",o.setCustomValidity("")):(r.textContent="Введіть правильний email!",o.setCustomValidity("invalid"),t=!1)})),e.classList.add("was-validated"),t&&(e.reset(),e.classList.remove("was-validated"))}})),t}}},t={};function o(r){var s=t[r];if(void 0!==s)return s.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}(()=>{const e=o(524),t=o(154),r=o(421),s=o(529),a=o(369);class i{constructor(){this.libraryService=new t.LibraryService,console.log(this.libraryService.getAllBooks()),console.log(this.libraryService.getAllUsers()),this.loadDataFromLocalStorage(),this.blockBooks(),this.blockUsers()}loadDataFromLocalStorage(){const e=r.Storage.loadElementState("book_items"),t=document.querySelector(".book_items");t&&e&&(t.innerHTML=e),this.blockModal();const o=r.Storage.loadElementState("user_items"),s=document.querySelector(".user_items");s&&o&&(s.innerHTML=o)}blockBooks(){var t,o;null===(t=document.querySelector(".btn_clear_books"))||void 0===t||t.addEventListener("click",(()=>{this.libraryService.clearBooks();const e=document.querySelector(".book_items");e&&(e.innerHTML=""),r.Storage.clearData("book_items")})),null===(o=document.querySelector(".input_add_book"))||void 0===o||o.addEventListener("click",(t=>{var o,i,n;t.preventDefault();const l=document.querySelector(".book_items"),d=null===(o=document.querySelector(".input_name_book"))||void 0===o?void 0:o.value,c=null===(i=document.querySelector(".input_author_book"))||void 0===i?void 0:i.value,u=null===(n=document.querySelector(".input_release_year"))||void 0===n?void 0:n.value;if((0,s.ValidationBook)()){const t=new e.Book(d,c,parseInt(u));this.libraryService.addBook(t);const o=document.createElement("div"),s=document.createElement("div");s.classList.add("d-flex","justify-content-between");const i=document.createElement("span");i.textContent=t.printInfo(),i.classList.add("fs-5");const n=document.createElement("button");n.textContent="Позичити",n.type="button",n.classList.add("btnBorrowOff","btn","btn-primary","btn-sm"),a.Modal.showBorrowModal(n);const m=document.createElement("hr");s.appendChild(i),s.appendChild(n),o.appendChild(s),o.appendChild(m),null==l||l.appendChild(o),r.Storage.saveElementState("book_items",(null==l?void 0:l.innerHTML)||""),this.blockModal()}}))}blockUsers(){var t,o;let a=parseInt(localStorage.getItem("lastUserId")||"0")+1;const i=()=>{localStorage.removeItem("lastUserId"),a=1};null===(t=document.querySelector(".btn_clear_users"))||void 0===t||t.addEventListener("click",(()=>{this.libraryService.clearUsers();const e=document.querySelector(".user_items");e&&(e.innerHTML=""),r.Storage.clearData("user_items"),i()})),null===(o=document.querySelector(".input_add_user"))||void 0===o||o.addEventListener("click",(t=>{var o,n;t.preventDefault();const l=document.querySelector(".user_items"),d=null===(o=document.querySelector(".input_username"))||void 0===o?void 0:o.value,c=null===(n=document.querySelector(".input_email"))||void 0===n?void 0:n.value;if((0,s.ValidationUser)()){(null==l?void 0:l.innerHTML.trim())||i();const t=a++,o=new e.User(t,d,c);this.libraryService.addUser(o);const s=document.createElement("div"),n=document.createElement("div");n.classList.add("d-flex","justify-content-between");const u=document.createElement("span");u.textContent=o.printInfo(),u.classList.add("fs-5");const m=document.createElement("hr");n.appendChild(u),s.appendChild(n),s.appendChild(m),null==l||l.appendChild(s),r.Storage.saveElementState("user_items",(null==l?void 0:l.innerHTML)||""),localStorage.setItem("lastUserId",t.toString())}}))}blockModal(){const e=document.querySelectorAll(".btnBorrowOff");let t=null;e.forEach((e=>{a.Modal.showBorrowModal(e),e.addEventListener("click",(()=>{var o,r,s;t=e;const a=(null===(s=null===(r=null===(o=e.closest("div"))||void 0===o?void 0:o.querySelector("span"))||void 0===r?void 0:r.textContent)||void 0===s?void 0:s.trim())||"",[i]=a.split(" by ");t.setAttribute("data-book",i)}))}));const o=document.getElementById("btn_save"),r=document.getElementById("input_borrow");o.addEventListener("click",(()=>{if(!t)return void console.error("Немає активної кнопки позичення.");const e=r.value.trim(),o=t.getAttribute("data-book");e&&o&&this.libraryService.borrowBook(o,parseInt(e))&&(t.textContent="Повернути",t.classList.replace("btn-primary","btn-warning"),a.Modal.hideBorrowModal())}))}}document.addEventListener("DOMContentLoaded",(()=>{console.log("DOM fully loaded and parsed"),new i}))})()})();